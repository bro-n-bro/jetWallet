"use strict";(self["webpackChunkcosmos_telegram_signer"]=self["webpackChunkcosmos_telegram_signer"]||[]).push([[968],{98818:function(e,a,t){t.d(a,{A:function(){return j}});t(44114);var l=t(56768),n=t(24232),i=t(45130),u=t(90144),s=t(24113),o=t(20033),r=t(81387),c=t(43738),v=t(36571);const d=s+"#ic_biometric_face",p=s+"#ic_biometric_finger",m={class:"pin"},g={class:"field_label"},b={class:"field"},h={class:"field"},k=["disabled"],_={class:"field"},f=["disabled"],L={class:"field"},y=["disabled"],w={class:"field"},C=["disabled"],R={class:"field"},E=["disabled"],A={key:0,class:"warning"},K={key:0,class:"icon"},T={key:1,class:"icon"},$={class:"btns"},X={key:0},U={key:1},W={key:2};var x={__name:"Auth",props:{mode:{type:String,default:"all"}},setup(e){const a=e,t=(0,o.useGlobalStore)(),s=(0,r.rd)(),x=(0,l.WQ)("emitter"),B=(0,u.KR)(["","","","","",""]),I=(0,u.KR)(""),j=(0,u.KR)(""),Q=(0,u.KR)(!1),V=(0,u.KR)(t.authErrorLimit),J=(0,u.KR)(!1),M=(0,u.KR)(!1),S=(0,u.KR)("finger");function D(e,a){setTimeout((()=>{e.target.value.length>=1&&a<6&&e.target.closest(".row").querySelector(`.field:nth-child(${a+1}) input`).focus()}))}function q(e,a){setTimeout((()=>{0===e.target.value.length&&a>0&&e.target.closest(".row").querySelector(`.field:nth-child(${a}) input`).select()}))}function z(){Telegram.WebApp.isAccessGranted?G():Telegram.WebApp.BiometricManager.requestAccess({reason:""},(()=>G()))}function G(){Telegram.WebApp.BiometricManager.authenticate({reason:""},(e=>{e&&x.emit("auth")}))}async function F(){let e=await P();e?(V.value=t.authErrorLimit,x.emit("auth")):await H()}async function P(){let e=await(0,c.mK)(B.value.join(""),j.value);return e===I.value}async function H(){Q.value=!0;let e=V.value-1;V.value=e,t.isAuthorized?e||x.emit("show_error_sign_tx_modal"):(await t.updateUserAuthErrorLimit(e),e||(await t.setUserLock(),s.push("/lock"))),B.value=["","","","","",""],Q.value=!1}(0,l.KC)((async()=>{let e=await(0,v.pQ)("global",["pin","authErrorLimit","isBiometric","hmacKey"]);I.value=e.pin,j.value=e.hmacKey,V.value=e.authErrorLimit,"all"===a.mode&&(J.value=e.isBiometric,M.value=Telegram.WebApp.BiometricManager.isBiometricAvailable,"unknown"!=Telegram.WebApp.BiometricManager.biometricType&&(S.value=Telegram.WebApp.BiometricManager.biometricType),M.value&&J.value&&z())})),(0,l.wB)(B.value,(()=>{B.value[5].length&&document.activeElement.blur(),B.value[5].length&&V.value===t.authErrorLimit&&F()}));const N=(0,l.EW)((()=>""!=B.value[5].length));return(e,s)=>((0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",m,[(0,l.Lk)("div",g,(0,n.v_)(e.$t("message.auth_enter_pin_label")),1),(0,l.Lk)("div",{class:(0,n.C4)(["row",{error:Q.value}])},[(0,l.Lk)("div",b,[(0,l.bo)((0,l.Lk)("input",{type:"password",class:(0,n.C4)(["input big",{active:B.value[0].length}]),"onUpdate:modelValue":s[0]||(s[0]=e=>B.value[0]=e),maxlength:"1",inputmode:"numeric",ref:"inputRef",onInput:s[1]||(s[1]=e=>D(e,1)),onKeydown:s[2]||(s[2]=(0,i.jR)((e=>q(e,0)),["backspace"]))},null,34),[[i.Jo,B.value[0]]])]),(0,l.Lk)("div",h,[(0,l.bo)((0,l.Lk)("input",{type:"password",class:(0,n.C4)(["input big",{active:B.value[1].length}]),"onUpdate:modelValue":s[3]||(s[3]=e=>B.value[1]=e),maxlength:"1",inputmode:"numeric",disabled:!B.value[0].length,onInput:s[4]||(s[4]=e=>D(e,2)),onKeydown:s[5]||(s[5]=(0,i.jR)((e=>q(e,1)),["backspace"]))},null,42,k),[[i.Jo,B.value[1]]])]),(0,l.Lk)("div",_,[(0,l.bo)((0,l.Lk)("input",{type:"password",class:(0,n.C4)(["input big",{active:B.value[2].length}]),"onUpdate:modelValue":s[6]||(s[6]=e=>B.value[2]=e),maxlength:"1",inputmode:"numeric",disabled:!B.value[1].length,onInput:s[7]||(s[7]=e=>D(e,3)),onKeydown:s[8]||(s[8]=(0,i.jR)((e=>q(e,2)),["backspace"]))},null,42,f),[[i.Jo,B.value[2]]])]),(0,l.Lk)("div",L,[(0,l.bo)((0,l.Lk)("input",{type:"password",class:(0,n.C4)(["input big",{active:B.value[3].length}]),"onUpdate:modelValue":s[9]||(s[9]=e=>B.value[3]=e),maxlength:"1",inputmode:"numeric",disabled:!B.value[2].length,onInput:s[10]||(s[10]=e=>D(e,4)),onKeydown:s[11]||(s[11]=(0,i.jR)((e=>q(e,3)),["backspace"]))},null,42,y),[[i.Jo,B.value[3]]])]),(0,l.Lk)("div",w,[(0,l.bo)((0,l.Lk)("input",{type:"password",class:(0,n.C4)(["input big",{active:B.value[4].length}]),"onUpdate:modelValue":s[12]||(s[12]=e=>B.value[4]=e),maxlength:"1",inputmode:"numeric",disabled:!B.value[3].length,onInput:s[13]||(s[13]=e=>D(e,5)),onKeydown:s[14]||(s[14]=(0,i.jR)((e=>q(e,4)),["backspace"]))},null,42,C),[[i.Jo,B.value[4]]])]),(0,l.Lk)("div",R,[(0,l.bo)((0,l.Lk)("input",{type:"password",class:(0,n.C4)(["input big",{active:B.value[5].length}]),"onUpdate:modelValue":s[15]||(s[15]=e=>B.value[5]=e),maxlength:"1",inputmode:"numeric",disabled:!B.value[4].length,onInput:s[16]||(s[16]=e=>D(e,6)),onKeydown:s[17]||(s[17]=(0,i.jR)((e=>q(e,5)),["backspace"]))},null,42,E),[[i.Jo,B.value[5]]])])],2),V.value<(0,u.R1)(t).authErrorLimit?((0,l.uX)(),(0,l.CE)("div",A,(0,n.v_)(e.$t("message.auth_error_warning",{count:V.value})),1)):(0,l.Q3)("",!0)]),"all"===a.mode&&M.value&&V.value==(0,u.R1)(t).authErrorLimit?((0,l.uX)(),(0,l.CE)("button",{key:0,class:"biometric_btn",onClick:s[18]||(s[18]=(0,i.D$)((e=>z()),["prevent"]))},[(0,l.Lk)("span",null,(0,n.v_)(e.$t("message.btn_biometric2")),1),"face"===e.biometrictype?((0,l.uX)(),(0,l.CE)("svg",K,s[20]||(s[20]=[(0,l.Lk)("use",{"xlink:href":d},null,-1)]))):((0,l.uX)(),(0,l.CE)("svg",T,s[21]||(s[21]=[(0,l.Lk)("use",{"xlink:href":p},null,-1)])))])):(0,l.Q3)("",!0),(0,l.Lk)("div",$,[V.value<(0,u.R1)(t).authErrorLimit?((0,l.uX)(),(0,l.CE)("button",{key:0,class:(0,n.C4)(["btn",{disabled:!N.value}]),onClick:s[19]||(s[19]=(0,i.D$)((e=>F()),["prevent"]))},[(0,u.R1)(t).isAuthorized&"pin"===a.mode?((0,l.uX)(),(0,l.CE)("span",X,(0,n.v_)(e.$t("message.btn_confirm")),1)):(0,u.R1)(t).isAuthorized?((0,l.uX)(),(0,l.CE)("span",U,(0,n.v_)(e.$t("message.btn_sign")),1)):((0,l.uX)(),(0,l.CE)("span",W,(0,n.v_)(e.$t("message.btn_login")),1))],2)):(0,l.Q3)("",!0)])],64))}},B=t(71241);const I=(0,B.A)(x,[["__scopeId","data-v-7439e9ec"]]);var j=I},70968:function(e,a,t){t.r(a),t.d(a,{default:function(){return f}});t(44114);var l=t(56768),n=t(24232),i=t(90144),u=t(20033),s=t(81387),o=t(36571),r=t(98818),c=t(74901);const v={class:"page_container auth_page"},d={class:"cont"},p={class:"page_title"},m={class:"page_data_wrap"},g={class:"page_data"},b={class:"version"};var h={__name:"AuthPage",setup(e){const a=(0,u.useGlobalStore)(),t=(0,s.rd)(),h=(0,l.WQ)("emitter"),k=(0,i.KR)(!0),_="2025.01.31-527";return(0,l.sV)((async()=>{let e=await(0,o.$R)("global","userLockTimestamp");new Date(e)-new Date<a.userLockTime&&await a.setUserUnlock(),k.value=!1})),(0,l.hi)((()=>{h.off("auth")})),h.on("auth",(async()=>{await a.auth(),k.value=!1,t.push("/account")})),(e,a)=>((0,l.uX)(),(0,l.CE)("section",v,[(0,l.Lk)("div",d,[(0,l.Lk)("div",p,(0,n.v_)(e.$t("message.auth_title")),1),(0,l.Lk)("div",m,[(0,l.Lk)("div",g,[k.value?((0,l.uX)(),(0,l.Wv)(c.A,{key:0})):(0,l.Q3)("",!0),(0,l.bF)(r.A),(0,l.Lk)("div",b,(0,n.v_)((0,i.R1)(_)),1)])])])]))}},k=t(71241);const _=(0,k.A)(h,[["__scopeId","data-v-450f0b45"]]);var f=_}}]);
//# sourceMappingURL=968.aba6be2a.js.map