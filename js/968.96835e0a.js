"use strict";(self["webpackChunkcosmos_telegram_signer"]=self["webpackChunkcosmos_telegram_signer"]||[]).push([[968],{67622:function(e,a,t){t.d(a,{A:function(){return I}});t(44114);var l=t(56768),n=t(24232),i=t(45130),u=t(90144),s=t(24113),o=t(20033),r=t(81387),c=t(43738),v=t(36571);const d=s+"#ic_biometric_face",p=s+"#ic_biometric_finger",m={class:"pin"},g={class:"field_label"},b={class:"field"},h={class:"field"},k=["disabled"],_={class:"field"},L=["disabled"],f={class:"field"},w=["disabled"],y={class:"field"},C=["disabled"],R={class:"field"},E=["disabled"],K={key:0,class:"warning"},A={key:0,class:"icon"},T={key:1,class:"icon"},$={class:"btns"},U={key:0},W={key:1};var X={__name:"Auth",setup(e){const a=(0,o.useGlobalStore)(),t=(0,r.rd)(),s=(0,l.WQ)("emitter"),X=(0,u.KR)(["","","","","",""]),x=(0,u.KR)(""),B=(0,u.KR)(""),I=(0,u.KR)(!1),j=(0,u.KR)(a.authErrorLimit),Q=(0,u.KR)(!1),V=(0,u.KR)(!1),J=(0,u.KR)("finger");function M(e,a){setTimeout((()=>{e.target.value.length>=1&&a<6&&e.target.closest(".row").querySelector(`.field:nth-child(${a+1}) input`).focus()}))}function D(e,a){setTimeout((()=>{0===e.target.value.length&&a>0&&e.target.closest(".row").querySelector(`.field:nth-child(${a}) input`).select()}))}function S(){Telegram.WebApp.isAccessGranted?q():Telegram.WebApp.BiometricManager.requestAccess({reason:""},(()=>q()))}function q(){Telegram.WebApp.BiometricManager.authenticate({reason:""},(e=>{e&&s.emit("auth")}))}async function G(){let e=await z();e?(j.value=a.authErrorLimit,s.emit("auth")):await F()}async function z(){let e=await(0,c.mK)(X.value.join(""),B.value);return e===x.value}async function F(){I.value=!0;let e=j.value-1;j.value=e,a.isAuthorized?e||s.emit("show_error_sign_tx_modal"):(await a.updateUserAuthErrorLimit(e),e||(await a.setUserLock(),t.push("/lock"))),X.value=["","","","","",""],I.value=!1}(0,l.KC)((async()=>{let e=await(0,v.pQ)("global",["pin","authErrorLimit","isBiometric","hmacKey"]);x.value=e.pin,B.value=e.hmacKey,j.value=e.authErrorLimit,Q.value=e.isBiometric,V.value=Telegram.WebApp.BiometricManager.isBiometricAvailable,"unknown"!=Telegram.WebApp.BiometricManager.biometricType&&(J.value=Telegram.WebApp.BiometricManager.biometricType),V.value&&Q.value&&S()})),(0,l.wB)(X.value,(()=>{X.value[5].length&&document.activeElement.blur(),X.value[5].length&&j.value===a.authErrorLimit&&G()}));const P=(0,l.EW)((()=>""!=X.value[5].length));return(e,t)=>((0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",m,[(0,l.Lk)("div",g,(0,n.v_)(e.$t("message.auth_enter_pin_label")),1),(0,l.Lk)("div",{class:(0,n.C4)(["row",{error:I.value}])},[(0,l.Lk)("div",b,[(0,l.bo)((0,l.Lk)("input",{type:"password",class:(0,n.C4)(["input big",{active:X.value[0].length}]),"onUpdate:modelValue":t[0]||(t[0]=e=>X.value[0]=e),maxlength:"1",inputmode:"numeric",ref:"inputRef",onInput:t[1]||(t[1]=e=>M(e,1)),onKeydown:t[2]||(t[2]=(0,i.jR)((e=>D(e,0)),["backspace"]))},null,34),[[i.Jo,X.value[0]]])]),(0,l.Lk)("div",h,[(0,l.bo)((0,l.Lk)("input",{type:"password",class:(0,n.C4)(["input big",{active:X.value[1].length}]),"onUpdate:modelValue":t[3]||(t[3]=e=>X.value[1]=e),maxlength:"1",inputmode:"numeric",disabled:!X.value[0].length,onInput:t[4]||(t[4]=e=>M(e,2)),onKeydown:t[5]||(t[5]=(0,i.jR)((e=>D(e,1)),["backspace"]))},null,42,k),[[i.Jo,X.value[1]]])]),(0,l.Lk)("div",_,[(0,l.bo)((0,l.Lk)("input",{type:"password",class:(0,n.C4)(["input big",{active:X.value[2].length}]),"onUpdate:modelValue":t[6]||(t[6]=e=>X.value[2]=e),maxlength:"1",inputmode:"numeric",disabled:!X.value[1].length,onInput:t[7]||(t[7]=e=>M(e,3)),onKeydown:t[8]||(t[8]=(0,i.jR)((e=>D(e,2)),["backspace"]))},null,42,L),[[i.Jo,X.value[2]]])]),(0,l.Lk)("div",f,[(0,l.bo)((0,l.Lk)("input",{type:"password",class:(0,n.C4)(["input big",{active:X.value[3].length}]),"onUpdate:modelValue":t[9]||(t[9]=e=>X.value[3]=e),maxlength:"1",inputmode:"numeric",disabled:!X.value[2].length,onInput:t[10]||(t[10]=e=>M(e,4)),onKeydown:t[11]||(t[11]=(0,i.jR)((e=>D(e,3)),["backspace"]))},null,42,w),[[i.Jo,X.value[3]]])]),(0,l.Lk)("div",y,[(0,l.bo)((0,l.Lk)("input",{type:"password",class:(0,n.C4)(["input big",{active:X.value[4].length}]),"onUpdate:modelValue":t[12]||(t[12]=e=>X.value[4]=e),maxlength:"1",inputmode:"numeric",disabled:!X.value[3].length,onInput:t[13]||(t[13]=e=>M(e,5)),onKeydown:t[14]||(t[14]=(0,i.jR)((e=>D(e,4)),["backspace"]))},null,42,C),[[i.Jo,X.value[4]]])]),(0,l.Lk)("div",R,[(0,l.bo)((0,l.Lk)("input",{type:"password",class:(0,n.C4)(["input big",{active:X.value[5].length}]),"onUpdate:modelValue":t[15]||(t[15]=e=>X.value[5]=e),maxlength:"1",inputmode:"numeric",disabled:!X.value[4].length,onInput:t[16]||(t[16]=e=>M(e,6)),onKeydown:t[17]||(t[17]=(0,i.jR)((e=>D(e,5)),["backspace"]))},null,42,E),[[i.Jo,X.value[5]]])])],2),j.value<(0,u.R1)(a).authErrorLimit?((0,l.uX)(),(0,l.CE)("div",K,(0,n.v_)(e.$t("message.auth_error_warning",{count:j.value})),1)):(0,l.Q3)("",!0)]),V.value&&j.value==(0,u.R1)(a).authErrorLimit?((0,l.uX)(),(0,l.CE)("button",{key:0,class:"biometric_btn",onClick:(0,i.D$)(S,["prevent"])},[(0,l.Lk)("span",null,(0,n.v_)(e.$t("message.btn_biometric2")),1),"face"===e.biometrictype?((0,l.uX)(),(0,l.CE)("svg",A,t[19]||(t[19]=[(0,l.Lk)("use",{"xlink:href":d},null,-1)]))):((0,l.uX)(),(0,l.CE)("svg",T,t[20]||(t[20]=[(0,l.Lk)("use",{"xlink:href":p},null,-1)])))])):(0,l.Q3)("",!0),(0,l.Lk)("div",$,[j.value<(0,u.R1)(a).authErrorLimit?((0,l.uX)(),(0,l.CE)("button",{key:0,class:(0,n.C4)(["btn",{disabled:!P.value}]),onClick:t[18]||(t[18]=(0,i.D$)((e=>G()),["prevent"]))},[(0,u.R1)(a).isAuthorized?((0,l.uX)(),(0,l.CE)("span",U,(0,n.v_)(e.$t("message.btn_sign")),1)):((0,l.uX)(),(0,l.CE)("span",W,(0,n.v_)(e.$t("message.btn_login")),1))],2)):(0,l.Q3)("",!0)])],64))}},x=t(71241);const B=(0,x.A)(X,[["__scopeId","data-v-1d273735"]]);var I=B},70968:function(e,a,t){t.r(a),t.d(a,{default:function(){return L}});t(44114);var l=t(56768),n=t(24232),i=t(90144),u=t(20033),s=t(81387),o=t(36571),r=t(67622),c=t(74901);const v={class:"page_container auth_page"},d={class:"cont"},p={class:"page_title"},m={class:"page_data_wrap"},g={class:"page_data"},b={class:"version"};var h={__name:"AuthPage",setup(e){const a=(0,u.useGlobalStore)(),t=(0,s.rd)(),h=(0,l.WQ)("emitter"),k=(0,i.KR)(!0),_="2025.01.26-520";return(0,l.sV)((async()=>{let e=await(0,o.$R)("global","userLockTimestamp");new Date(e)-new Date<a.userLockTime&&await a.setUserUnlock(),k.value=!1})),(0,l.hi)((()=>{h.off("auth")})),h.on("auth",(async()=>{await a.auth(),k.value=!1,t.push("/account")})),(e,a)=>((0,l.uX)(),(0,l.CE)("section",v,[(0,l.Lk)("div",d,[(0,l.Lk)("div",p,(0,n.v_)(e.$t("message.auth_title")),1),(0,l.Lk)("div",m,[(0,l.Lk)("div",g,[k.value?((0,l.uX)(),(0,l.Wv)(c.A,{key:0})):(0,l.Q3)("",!0),(0,l.bF)(r.A),(0,l.Lk)("div",b,(0,n.v_)((0,i.R1)(_)),1)])])])]))}},k=t(71241);const _=(0,k.A)(h,[["__scopeId","data-v-450f0b45"]]);var L=_}}]);
//# sourceMappingURL=968.96835e0a.js.map